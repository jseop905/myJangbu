# ë§ˆì´ì¥ë¶€ (myJangbu) - Cursor Rules

## í”„ë¡œì íŠ¸ ê°œìš”
- **ëª©ì **: ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
- **ìŠ¤íƒ**: Next.js 14 (App Router), TypeScript, Prisma, PostgreSQL
- **ì•„í‚¤í…ì²˜**: FSD (Feature-Sliced Design)
- **UI**: Tailwind CSS, shadcn/ui, Recharts
- **ìƒíƒœê´€ë¦¬**: TanStack Query, Zustand

---

## ğŸ—ï¸ FSD ì•„í‚¤í…ì²˜ ê·œì¹™

### ë ˆì´ì–´ êµ¬ì¡° ë° ì˜ì¡´ì„±
```
app â†’ widgets â†’ features â†’ entities â†’ shared
```

**ì ˆëŒ€ ê·œì¹™**:
- í•˜ìœ„ ë ˆì´ì–´ëŠ” ìƒìœ„ ë ˆì´ì–´ë¥¼ import í•  ìˆ˜ ì—†ìŒ
- ê°™ì€ ë ˆì´ì–´ ë‚´ cross-import ê¸ˆì§€ (íŠ¹íˆ entities, features)
- ëª¨ë“  importëŠ” ì ˆëŒ€ê²½ë¡œ ì‚¬ìš© (`@/`)

### ë ˆì´ì–´ë³„ ì—­í• 

#### `shared/` - ê³µí†µ ì½”ë“œ
- **ëª©ì **: í”„ë¡œì íŠ¸ ì „ì—­ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥ ì½”ë“œ
- **í¬í•¨**: UI ì»´í¬ë„ŒíŠ¸, ìœ í‹¸ í•¨ìˆ˜, íƒ€ì…, API í´ë¼ì´ì–¸íŠ¸, ìƒìˆ˜
- **ê¸ˆì§€**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë‹¤ë¥¸ ë ˆì´ì–´ import
- **ìœ„ì¹˜**:
  - `shared/ui/` - shadcn/ui ê¸°ë°˜ ê³µí†µ UI ì»´í¬ë„ŒíŠ¸
  - `shared/lib/` - ìœ í‹¸ í•¨ìˆ˜, Prisma í´ë¼ì´ì–¸íŠ¸
  - `shared/api/` - API í´ë¼ì´ì–¸íŠ¸, fetch ë˜í¼
  - `shared/types/` - ì „ì—­ TypeScript íƒ€ì…
  - `shared/config/` - ìƒìˆ˜, í™˜ê²½ ì„¤ì •

#### `entities/` - ë¹„ì¦ˆë‹ˆìŠ¤ ì—”í‹°í‹°
- **ëª©ì **: ë„ë©”ì¸ ëª¨ë¸ (Transaction, Category, Account ë“±)
- **í¬í•¨**: 
  - `model.ts` - Zod ìŠ¤í‚¤ë§ˆ, íƒ€ì… ì •ì˜
  - `hooks.ts` - React Query ì¡°íšŒ(GET) hooks
  - `ui/` - ì—”í‹°í‹° í‘œì‹œìš© ì»´í¬ë„ŒíŠ¸ (ì•¡ì…˜ ì—†ìŒ)
- **ê¸ˆì§€**: Mutation hooks (ìƒì„±/ìˆ˜ì •/ì‚­ì œ), ì‚¬ìš©ì ì•¡ì…˜
- **ì˜ˆì‹œ**: `entities/transaction/model.ts`

#### `features/` - ì‚¬ìš©ì ê¸°ëŠ¥
- **ëª©ì **: ì‚¬ìš©ì ì¸í„°ë™ì…˜/ì•¡ì…˜
- **í¬í•¨**:
  - `hooks.ts` - Mutation hooks (POST, PUT, DELETE)
  - UI ì»´í¬ë„ŒíŠ¸ - ëª¨ë‹¬, í¼, ë²„íŠ¼ ë“±
- **ì˜ˆì‹œ**: `features/transaction/create-dialog.tsx`

#### `widgets/` - ë³µí•© ìœ„ì ¯
- **ëª©ì **: ì—¬ëŸ¬ entities + featuresë¥¼ ì¡°í•©í•œ í° UI ë¸”ë¡
- **í¬í•¨**: `ui.tsx`, `hooks.ts`
- **ì˜ˆì‹œ**: `widgets/ledger-summary/ui.tsx` (ìš”ì•½ ì¹´ë“œ + ì°¨íŠ¸)

#### `app/` - ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´
- **ëª©ì **: Next.js ë¼ìš°íŒ…, í˜ì´ì§€, API Routes
- **í¬í•¨**:
  - `page.tsx` - í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (ì–‡ê²Œ ìœ ì§€, ìœ„ì ¯ ì¡°í•©ë§Œ)
  - `layout.tsx` - ë ˆì´ì•„ì›ƒ
  - `api/` - API Routes (ë°±ì—”ë“œ)
- **ê¸ˆì§€**: ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (widgetsë¡œ ì´ë™)

---

## ğŸ“ ì½”ë”© ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

### TypeScript
- **strict mode**: í•­ìƒ í™œì„±í™”
- **íƒ€ì… ì„ ì–¸**: `interface`ë³´ë‹¤ `type` ì„ í˜¸ (DTO, Props)
- **any ê¸ˆì§€**: ë¶ˆê°€í”¼í•œ ê²½ìš° `unknown` ì‚¬ìš© í›„ íƒ€ì… ê°€ë“œ
- **nullable**: `| null` ëª…ì‹œì  ì‚¬ìš©
- **ë¯¸ì‚¬ìš© ë³€ìˆ˜**: `_` prefix ì‚¬ìš© (ì˜ˆ: `_unusedParam`)

### React ì»´í¬ë„ŒíŠ¸
- **í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸**: arrow function ì‚¬ìš©
```typescript
export function MyComponent() {
  return <div>...</div>;
}
```
- **"use client"**: í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ë§Œ ëª…ì‹œ
- **Props íƒ€ì…**: í•­ìƒ ëª…ì‹œ
```typescript
interface MyComponentProps {
  title: string;
  onClose: () => void;
}
```
- **Export**: named export ìš°ì„  (defaultëŠ” page.tsxë§Œ)

### ë„¤ì´ë° ì»¨ë²¤ì…˜
- **ì»´í¬ë„ŒíŠ¸**: PascalCase (`TransactionCard`)
- **íŒŒì¼ëª…**: kebab-case (`transaction-card.tsx`)
- **hooks**: camelCase, `use` prefix (`useTransactions`)
- **ìƒìˆ˜**: UPPER_SNAKE_CASE (`DEFAULT_TIMEZONE`)
- **API ì—”ë“œí¬ì¸íŠ¸**: kebab-case (`/api/ledger/summary`)

---

## ğŸ”Œ API ì„¤ê³„ ê·œì¹™

### REST API Routes
- **ìœ„ì¹˜**: `app/api/[resource]/route.ts`
- **ë©”ì„œë“œ**: GET, POST, PUT, DELETE
- **ì‘ë‹µ í¬ë§·**:
```typescript
{
  success: boolean;
  data?: T;
  error?: string;
}
```

### API êµ¬í˜„ íŒ¨í„´
```typescript
export async function POST(request: NextRequest) {
  try {
    const userId = await getCurrentUserId();
    const body = await request.json();
    
    // 1. Zod ê²€ì¦
    const validated = schema.parse(body);
    
    // 2. Prisma ì¿¼ë¦¬ (userId ìŠ¤ì½”í•‘ í•„ìˆ˜!)
    const result = await prisma.model.create({
      data: { ...validated, userId },
    });
    
    return apiSuccess(result, 201);
  } catch (error: any) {
    if (error.name === "ZodError") return handleZodError(error);
    return handleServerError(error);
  }
}
```

### API í˜¸ì¶œ (í´ë¼ì´ì–¸íŠ¸)
- **TanStack Query ì‚¬ìš©**: useQuery (ì¡°íšŒ), useMutation (ë³€ê²½)
- **ìºì‹œ ë¬´íš¨í™”**: mutation onSuccessì—ì„œ `invalidateQueries`
```typescript
export function useCreateTransaction() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: (data) => apiClient.post("/api/transactions", data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["transactions"] });
    },
  });
}
```

---

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ê·œì¹™

### Prisma ì¿¼ë¦¬
- **userId ìŠ¤ì½”í•‘**: ëª¨ë“  ì¿¼ë¦¬ì— í•„ìˆ˜
```typescript
await prisma.transaction.findMany({
  where: { userId },  // í•„ìˆ˜!
});
```
- **N+1 ë°©ì§€**: `include`ë¡œ join select
- **ì§‘ê³„**: DBì—ì„œ ì²˜ë¦¬ (`groupBy`, `aggregate`)
- **í˜ì´ì§€ë„¤ì´ì…˜**: `take`, `skip` ì‚¬ìš©

### ì‹œê°„ëŒ€ ì²˜ë¦¬
- **DB ì €ì¥**: UTC (`new Date()`)
- **í´ë¼ì´ì–¸íŠ¸ í‘œì‹œ**: `Asia/Seoul` (user.timezone)
- **ë‚ ì§œ ì…ë ¥**: `datetime-local` â†’ UTC ë³€í™˜

### ê¸ˆì•¡ ì²˜ë¦¬
- **íƒ€ì…**: `Int` (ë¶€ë™ì†Œìˆ˜ ê¸ˆì§€)
- **í†µí™”**: ì›í™”(KRW) ì •ìˆ˜
- **ë¶€í˜¸**: `type` í•„ë“œë¡œ êµ¬ë¶„ (income/expense), ê¸ˆì•¡ì€ í•­ìƒ ì–‘ìˆ˜

---

## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸ ê·œì¹™

### shadcn/ui ì‚¬ìš©
- **ìœ„ì¹˜**: `shared/ui/`
- **import**: `@/shared/ui/[component]`
- **ì»¤ìŠ¤í„°ë§ˆì´ì§•**: í•„ìš” ì‹œ íŒŒì¼ ì§ì ‘ ìˆ˜ì • OK
- **ì‹ ê·œ ì»´í¬ë„ŒíŠ¸**: ê³µì‹ ë¬¸ì„œ ë”°ë¼ ì¶”ê°€

### Tailwind CSS
- **ìœ í‹¸ë¦¬í‹° ìš°ì„ **: inline className ì‚¬ìš©
- **ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼**: `cn()` í—¬í¼ ì‚¬ìš©
```typescript
<div className={cn("base-class", isActive && "active-class")} />
```
- **ìƒ‰ìƒ**: CSS ë³€ìˆ˜ ì‚¬ìš© (`text-primary`, `bg-muted`)

### í¼ ì²˜ë¦¬
- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: React Hook Form + Zod
```typescript
const { register, handleSubmit, formState: { errors } } = useForm({
  resolver: zodResolver(schema),
});
```
- **ì—ëŸ¬ í‘œì‹œ**: í•„ë“œ ì•„ë˜ ë¹¨ê°„ í…ìŠ¤íŠ¸
- **ì œì¶œ ë²„íŠ¼**: disabled ìƒíƒœ í‘œì‹œ

---

## ğŸš¨ ë³´ì•ˆ ë° ê²€ì¦ ê·œì¹™

### ì…ë ¥ ê²€ì¦
- **í´ë¼ì´ì–¸íŠ¸**: React Hook Form + Zod
- **ì„œë²„**: Zod ìŠ¤í‚¤ë§ˆ ì¬ê²€ì¦ (í•„ìˆ˜!)
- **ì—ëŸ¬ ë©”ì‹œì§€**: í•œêµ­ì–´, êµ¬ì²´ì ìœ¼ë¡œ

### ì¸ì¦/ê¶Œí•œ
- **í˜„ì¬**: ë°ëª¨ ìœ ì € (ì„ì‹œ)
- **TODO**: NextAuth í†µí•© ì‹œ `getServerSession()` ì‚¬ìš©
- **userId**: ëª¨ë“  ë°ì´í„° ì ‘ê·¼ì— í•„ìˆ˜ ì²´í¬

---

## ğŸ“¦ íŒŒì¼ ìƒì„± ê°€ì´ë“œ

### ìƒˆ í˜ì´ì§€ ì¶”ê°€ ì‹œ
1. `app/[í˜ì´ì§€ëª…]/page.tsx` ìƒì„±
2. í•„ìš” ì‹œ `entities/[ì—”í‹°í‹°]/model.ts` ì •ì˜
3. `features/[ê¸°ëŠ¥]/hooks.ts` (mutation)
4. `features/[ê¸°ëŠ¥]/[UI].tsx` (ëª¨ë‹¬, í¼)
5. API Route í™•ì¸/ì¶”ê°€
6. `app/layout.tsx`ì— ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ ì¶”ê°€

### ìƒˆ ì—”í‹°í‹° ì¶”ê°€ ì‹œ
```
entities/[entity]/
â”œâ”€â”€ model.ts      # Zod ìŠ¤í‚¤ë§ˆ, íƒ€ì…
â”œâ”€â”€ hooks.ts      # useQuery hooks (ì¡°íšŒ)
â””â”€â”€ ui/           # í‘œì‹œ ì»´í¬ë„ŒíŠ¸ (ì„ íƒ)
```

### ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ
```
features/[feature]/
â”œâ”€â”€ hooks.ts      # useMutation hooks (CUD)
â””â”€â”€ [ui].tsx      # ì•¡ì…˜ UI (ëª¨ë‹¬, ë²„íŠ¼ ë“±)
```

---

## ğŸ§ª ê°œë°œ ê°€ì´ë“œë¼ì¸

### ì„±ëŠ¥ ìµœì í™”
- React Query ìºì‹± í™œìš© (`staleTime` ì„¤ì •)
- ì´ë¯¸ì§€: Next.js `<Image>` ì‚¬ìš©
- ë¬´ê±°ìš´ ì»´í¬ë„ŒíŠ¸: `React.lazy()` ê³ ë ¤

### ì—ëŸ¬ ì²˜ë¦¬
- API ì—ëŸ¬: try-catch + toast í‘œì‹œ (TODO: toast êµ¬í˜„)
- 404: ëª…í™•í•œ ë©”ì‹œì§€
- 500: ë¡œê·¸ ì¶œë ¥ + ì‚¬ìš©ìì—ê²Œ ì¼ë°˜ ë©”ì‹œì§€

### TODO ì£¼ì„ ê·œì¹™
```typescript
// TODO: [ê¸°ëŠ¥ëª…] - ì„¤ëª…
// TODO: NextAuth í†µí•© - ì‹¤ì œ ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ êµì²´
```

---

## ğŸš« ê¸ˆì§€ ì‚¬í•­

1. **any íƒ€ì… ë‚¨ë°œ**
2. **í•˜ìœ„ ë ˆì´ì–´ê°€ ìƒìœ„ ë ˆì´ì–´ import**
3. **userId ì—†ì´ ë°ì´í„° ì ‘ê·¼**
4. **í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ê²€ì¦** (ì„œë²„ ê²€ì¦ í•„ìˆ˜)
5. **inline styles** (Tailwind ì‚¬ìš©)
6. **console.log í”„ë¡œë•ì…˜ ì½”ë“œì— ë‚¨ê¸°ê¸°**
7. **í•˜ë“œì½”ë”©ëœ URL** (í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)

---

## âœ… ì½”ë“œ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] FSD ë ˆì´ì–´ ê·œì¹™ ì¤€ìˆ˜
- [ ] TypeScript strict ëª¨ë“œ í†µê³¼
- [ ] Zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦
- [ ] userId ìŠ¤ì½”í•‘ ì ìš©
- [ ] TanStack Query ìºì‹œ ë¬´íš¨í™”
- [ ] ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„
- [ ] ì ‘ê·¼ì„± (a11y) ê³ ë ¤
- [ ] ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼)
- [ ] í•œêµ­ì–´ ë©”ì‹œì§€
- [ ] TODO ì£¼ì„ ëª…í™•íˆ

---

**í”„ë¡œì íŠ¸ ë²„ì „**: v0.1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-05

